version: 2.1

orbs:
  slack: circleci/slack@4.10.1
  win: circleci/windows@5.0 

workflows:
  poc:
    jobs:
      - control:
          context: slack
      - slack/on-hold:
          context: slack
      - orbs-on-windows:
          context: slack
          matrix:
            parameters:
              executor:
                - win/default
                - win/server-2019
                # - win/server-2019-cuda
                - win/server-2022

jobs:
  orbs-on-windows:
    parameters:
      executor:
        type: string
    executor:
      name: << parameters.executor >>
      shell: bash
    steps:
      - run:
          name: Check sed
          command: cat template.json | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed 's/`/\\`/g' > output.txt
      - slack/notify:
          debug: true
          channel: cicd
      - store_artifacts:
          path: .
  control:
    docker:
      - image: cimg/base:stable
    steps:
      - slack/notify:
          debug: true
