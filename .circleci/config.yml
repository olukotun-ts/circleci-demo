version: 2.1
  
workflows:  # Collection of jobs orchestrated to run in a specific order
  version: 2.1
  build-test-deploy:
    jobs:
      - do:
          matrix:
            parameters:
              names: ["build", "test", "deploy"]
          contexts:
            - cloudSecrets

jobs:  # Collection of commands needed to accomplish a specific task
  do:
    docker:
      - image: cimg/node:15.11.0
        auth:
          username: $DOCKER_USER
          password: $DOCKER_PASS
    parameters:
      names:
        description: Name of job
        type: string
        default: ""
    steps:
      - run:
          name: Check environment
          command: |
            echo $CIRCLE_OIDC_TOKEN > oidc-token
            cat oidc-token
