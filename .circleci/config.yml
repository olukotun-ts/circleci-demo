version: 2.1

orbs:
  slack: circleci/slack@4.10.1
  win: circleci/windows@5.0 

workflows:
  poc:
    jobs:
      - control:
          context: slack
      - slack/on-hold:
          context: slack
      - orbs-on-windows:
          context: slack
          matrix:
            parameters:
              executor:
                - win/server-2019
                - win/server-2022
              shell:
                - bash
                - sh
                - ''

jobs:
  orbs-on-windows:
    parameters:
      executor:
        type: string
      shell:
        type: string
    executor:
      name: << parameters.executor >>
      shell: << parameters.shell >>
    steps:
      - checkout
      - run:
          name: Check jq output
          command: cat template.json | jq '@json' > jq_output.txt
      - slack/notify:
          debug: true
      - store_artifacts:
          path: .
  control:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout 
      - run:
          name: Check jq output
          command: cat template.json | jq '@json' > jq_output.txt
      - slack/notify:
          debug: true
